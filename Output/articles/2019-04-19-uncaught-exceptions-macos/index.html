<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"/><meta name="og:site_name" content="An Unheralded Perspective"/><link rel="canonical" href="https://siddarthkalra.github.io/articles/2019-04-19-uncaught-exceptions-macos"/><meta name="twitter:url" content="https://siddarthkalra.github.io/articles/2019-04-19-uncaught-exceptions-macos"/><meta name="og:url" content="https://siddarthkalra.github.io/articles/2019-04-19-uncaught-exceptions-macos"/><title>Uncaught exceptions on macOS | An Unheralded Perspective</title><meta name="twitter:title" content="Uncaught exceptions on macOS | An Unheralded Perspective"/><meta name="og:title" content="Uncaught exceptions on macOS | An Unheralded Perspective"/><meta name="description" content="I recently came across a peculiar distinction between how exceptions manifest on macOS vs. iOS. On iOS, if an NSRangeException (index out of bounds) occurs, your app will crash, no questions asked. However, that is not always the case on macOS"/><meta name="twitter:description" content="I recently came across a peculiar distinction between how exceptions manifest on macOS vs. iOS. On iOS, if an NSRangeException (index out of bounds) occurs, your app will crash, no questions asked. However, that is not always the case on macOS"/><meta name="og:description" content="I recently came across a peculiar distinction between how exceptions manifest on macOS vs. iOS. On iOS, if an NSRangeException (index out of bounds) occurs, your app will crash, no questions asked. However, that is not always the case on macOS"/><meta name="twitter:card" content="summary"/><link rel="stylesheet" href="/primaryTheme/styles.min.css" type="text/css"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><link rel="shortcut icon" href="/images/favicon.png" type="image/png"/><link rel="alternate" href="/feed.rss" type="application/rss+xml" title="Subscribe to An Unheralded Perspective"/></head><body class="item-page"><header><div class="wrapper"><a class="site-name" href="/">An Unheralded Perspective</a><nav><ul><li><a href="/about">About</a></li><li><a href="/articles">Articles</a></li></ul></nav></div></header><div class="wrapper"><article><div class="content"><h1>Uncaught exceptions on macOS</h1><p>I recently came across a peculiar distinction between how exceptions manifest on macOS vs. iOS.</p><p>On iOS, if an <code>NSRangeException</code> (index out of bounds) occurs, your app will crash, no questions asked. However, that is not always the case on macOS. This behaviour doesn't seem to be that widely known and I had to go digging quite a bit to uncover its roots.</p><p>On macOS, exceptions that go unhandled will rise to the level of the uncaught exception handler. This is the point where one can perform extra logic before the program exits. The default handler logs the exception to the console before exiting.</p><p>However, the key point is that exceptions on the main thread don't rise to the level of the uncaught exception handler as the global application object catches them preemptively. This is why certain exceptions don't lead to a crash on macOS. Apple details this behaviour <a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Exceptions/Concepts/UncaughtExceptions.html">here</a>.</p><p>If your app is using a crash reporting tool like <a href="https://Sentry.io">Sentry</a> or <a href="https://firebase.google.com/docs/crashlytics/">Crashlytics</a>, you don't want to silently log exceptions to the console. You want to know about them. So, how do we handle these exceptions?</p><p>We can subclass <code>NSApplication</code> and override the <code>reportException(_:)</code> method to provide our own custom behaviour:</p><pre><code><span class="splash-keyword">@objc</span>(<span class="splash-type">CustomExceptionHandlingApp</span>)
<span class="splash-keyword">class</span> CustomExceptionHandlingApp: <span class="splash-type">NSApplication</span> {

    <span class="splash-keyword">override func</span> reportException(<span class="splash-keyword">_</span> exception: <span class="splash-type">NSException</span>) {
        <span class="splash-type">UserDefaults</span>.<span class="splash-property">standard</span>.<span class="splash-call">register</span>(defaults: [<span class="splash-string">"NSApplicationCrashOnExceptions"</span>: <span class="splash-keyword">true</span>])

        <span class="splash-comment">// custom code to handle the exception here</span>

        <span class="splash-keyword">super</span>.<span class="splash-call">reportException</span>(exception)
    }

}
</code></pre><p>After creating the subclass, make sure to update the <code>NSPrincipalClass</code> key in your app's Info.plist to the name of the subclass instead of <code>NSApplication</code>.</p><p>The last thing to note is that if you want your application to exit when an exception occurs then set the <code>NSApplicationCrashOnExceptions</code> key to <code>true</code>.</p></div><span>Tags: </span><ul class="tag-list"><li class="tag tag-a"><a href="/tags/article">article</a></li><li class="tag tag-b"><a href="/tags/exceptions">exceptions</a></li><li class="tag tag-e"><a href="/tags/mac-os">mac os</a></li><li class="tag tag-a"><a href="/tags/swift">swift</a></li></ul></article></div><footer><p>An Unheralded Perspective © 2020 ⋅ All rights reserved</p><p>Built in Swift using <a href="https://github.com/johnsundell/publish" target="_blank">Publish</a></p><p><a href="https://twitter.com/siddarthkalra" target="_blank">Twitter</a> | <a href="/feed.rss" target="_blank">RSS</a></p></footer></body></html>