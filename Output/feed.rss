<?xml version="1.0" encoding="UTF-8"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content"><channel><title>An Unheralded Perspective</title><description>My thoughts on Swift, iOS development and beyond</description><link>https://siddarthkalra.github.io</link><language>en</language><lastBuildDate>Sat, 19 Dec 2020 16:27:00 -0500</lastBuildDate><pubDate>Sat, 19 Dec 2020 16:27:00 -0500</pubDate><ttl>250</ttl><atom:link href="https://siddarthkalra.github.io/feed.rss" rel="self" type="application/rss+xml"/><item><guid isPermaLink="true">https://siddarthkalra.github.io/posts/2020-12-19-migrated-to-publish</guid><title>Migrating to Publish</title><description>TBD</description><link>https://siddarthkalra.github.io/posts/2020-12-19-migrated-to-publish</link><pubDate>Sat, 19 Dec 2020 10:45:00 -0500</pubDate><content:encoded><![CDATA[<p>Today I'm so glad to announce that this website has been migrated to John Sundell's Publish static site generator ðŸŽ‰</p><p>I don't know the numbers but I'm almost giddy to join the growing number of static websites that are moving away from Ruby based static site generators. I want to take this opportunity to document some learnings and future enhancements.</p><h1>Getting setup</h1><p>I love working in Swift so this was a no-brainer for me. This website is hosted on GitHub Pages and previously you were almost forced to use Ruby based static site generators. Well, those days are over! So how easy was it to migrate this amazingly small website to Publish?</p><p>If you have previous Swift knowledge, this will be a breeze to setup. I want to give kudos to John Sundell for designing such a simple API that is also extensible at the same time (more on that in the next section).</p><p>Here are the minimum amount of steps you need to do complete in order to generate your fancy new website:</p><h2>Define your fancy new website</h2><p>This is done by conforming to the <code>Website</code> protocol.</p><pre><code><span class="splash-keyword">struct</span> FancyNewSite: <span class="splash-type">Website</span> {
    <span class="splash-keyword">enum</span> SectionID: <span class="splash-type">String</span>, <span class="splash-type">WebsiteSectionID</span> {
        <span class="splash-comment">// Add the sections that you want your website to contain here:</span>
        <span class="splash-keyword">case</span> posts
        <span class="splash-keyword">case</span> about
    }

    <span class="splash-keyword">struct</span> ItemMetadata: <span class="splash-type">WebsiteItemMetadata</span> {
        <span class="splash-comment">// Add any site-specific metadata that you want to use here.</span>
    }

    <span class="splash-comment">// Update these properties to configure your website:</span>
    <span class="splash-keyword">var</span> url = <span class="splash-type">URL</span>(string: <span class="splash-string">"https://fancynewsite.github.io"</span>)!
    <span class="splash-keyword">var</span> name = <span class="splash-string">"A Fancy New Site"</span>
    <span class="splash-keyword">var</span> description = <span class="splash-string">"Let's get fancy, shall we?"</span>
    <span class="splash-keyword">var</span> language: <span class="splash-type">Language</span> { .<span class="splash-dotAccess">english</span> }
    <span class="splash-keyword">var</span> imagePath: <span class="splash-type">Path</span>? { <span class="splash-keyword">nil</span> }
}
</code></pre><h2>Define a fancy theme</h2><p>This is how your website's HTML and CSS will be generated.</p><pre><code><span class="splash-keyword">extension</span> <span class="splash-type">Theme</span> <span class="splash-keyword">where</span> <span class="splash-type">Site</span> == <span class="splash-type">FancyNewSite</span> {
    <span class="splash-keyword">static var</span> fancyTheme <span class="splash-type">Self</span> {
        <span class="splash-type">Theme</span>(htmlFactory: <span class="splash-type">FancyHTMLFactory</span>(), resourcePaths: [<span class="splash-string">"Resources/fancyTheme/styles.css"</span>])
    }
}
</code></pre><p><code>FancyHTMLFactory</code> conforms to the <code>HTMLFactory</code> protocol. This is the type that will generate your website's HTML. Implement all the required methods and your site will be up and running in no time. Publish includes a default <code>foundation</code> theme that you can use as a reference.</p><h2>Define your fancy publishing pipeline</h2><p>There's two ways you go here. We can get all fancy (pun intended) here and use a custom pipeline or go with the default one that is provided out-of-the-box. I went with the default one for now since that has the advantage of being much quicker to setup.</p><pre><code><span class="splash-comment">// a default pipeline that generates your fancy site and deploys it to GitHub Pages</span>
<span class="splash-keyword">try</span> <span class="splash-type">FancyNewSite</span>().<span class="splash-call">publish</span>(withTheme: .<span class="splash-dotAccess">fancyTheme</span>,
                          deployedUsing: .<span class="splash-call">gitHub</span>(<span class="splash-string">"fancyNewSite/fancynewsite.github.io"</span>, useSSH: <span class="splash-keyword">true</span>)])
</code></pre><h2>Run locally then deploy</h2><p>Publish comes with a command line tool which provides the ability to run your website locally. Just execute the following in your terminal: <code>publish run -p 8000</code>.</p><p>Once you've iterated on your website locally it's time to share your hard work with the outside world. This, again, is extremely simple. Just run <code>publish deploy</code>.</p><p>That's it! You now have the excuse to feel all fancy.</p><img src="https://media.giphy.com/media/c0BgDP4p4gO8E/giphy.gif" alt="Fancy GIF"/><h1>Issues encountered</h1><p>OK putting all the fanciness aside, let's talk about some of the issues I encountered along the way.</p><h2>Local HTTP server blocks ports</h2><p>Every now again the HTTP server can develop a glitch and stop working. You'll get a message indicating the port you're trying to use is already taken. Not sure how this ends up happening but it can get a bit annoying as you're forced to choose a different port. I tried killing any Python process that was running on my machine but unfortunately that didn't remedy the problem.</p><p>However, really this just ended up being a problem with my original workflow? Every time I would regenerate my site, I would just restart the server thus increasing the likelihood of running into this problem. A better approach is to keep the HTTP server running and just use another shell to execute <code>publish generate</code> to regenerate your website without having to restart your HTTP server every time.</p><h2>Swift Package Manager</h2><p>Publish is just a Swift package and so is your website. I have experience with other dependency managers like Carthage, CocoaPods and even NPM but I'm pretty new to SPM myself.</p><p>In order to add Swift syntax highlighting to my posts, I decided to adopt John Sundell's Publish plugin for Splash. However, adding <code>SplashPublishPlugin</code> as a dependency in my website's Package.swift, broke my build. I couldn't generate my website anymore as Xcode would no longer detect that my website had any active targets.</p><p>POTENTIAL FOR GIF/MEME HERE</p><p>I was stumped. I had no idea how Xcode got into this state. So, I went for a swim in the world of SPM by reading Apple's docs and even Sundell's article on the subject. But I couldn't solve the problem. Ultimately, I just went snooping around Xcode and used some common sense. Somehow, I knew that I needed to reset my build and throw out any existing build artifacts and I found exactly what I was looking for:</p><p><code>File Ëƒ Swift Packages Ëƒ Reset Package Caches</code></p><p>This forces Xcode to regenerate your entire Package dependency chain. Once I chose this option all my problems were solved and I was back on track.</p><h2>Sections vs. Pages</h2><h2>ItemMetadata</h2><h2>Diffing the output HTML</h2><p>The really nice part of Publish is that, if you commit your Output directory to Git, you can track exactly how your website has changed every time you regenerate. This is a really nice way to catch regressions. The only issue is that the generated HTML is minified so understanding the diff becomes next to impossible.</p><p>If only there was a way to prevent this minification while your developing ðŸ¤”? Maybe there is but I haven't found it yet. I'll keep digging and report back if I find something!</p><h2>Deploying to GitHub Pages</h2><p>GitHub pages expects the content of your website to be situated in the root directory of your repository. However, my default, Publish will situate your generated website in <code>Output/</code>. <a href="https://briancoyner.github.io/articles/2020-02-25-cocoaheads_publish_notes/">Brian Coyner's article</a> on Publish came up with a great solution that I've adopted. The gist of the solution is as follows:</p><ul><li>Create a new branch called <code>author</code> or whatever suits your fancy</li><li>Push this branch to remote and make this your main branch on GitHub so that all new PRs are opened against this branch by default</li><li><code>author</code> now becomes your main trunk branch where the code for your Publish website package lives</li><li><code>master</code> becomes your deployment branch which only holds your generated HTML &amp; CSS for your website</li><li>Deploy new changes to <code>master</code> by using <code>publish deploy</code> (assuming that your publishing pipeline is already setup to deploy to GitHub)</li></ul><h1>Future enhancements</h1><p>Getting the initial version of my website up and running has been so much fun! However, there's at least a couple more things I still want to do to really streamline my process:</p><ul><li>for every new post, add the ability to automatically post a tweet and cross-publish the on Medium</li><li>add the ability to work on drafts without publishing them to the website before they're ready</li></ul><p>Once I have working solutions for the above, I hope to share my findings with you all. Thank you to all that stuck around till the end. That means a lot. All feedback is welcome, so please don't hesitate to reach out to me on <a href="https://twitter.com/siddarthkalra">Twitter</a>.</p>]]></content:encoded></item><item><guid isPermaLink="true">https://siddarthkalra.github.io/posts/2019-04-19-uncaught-exceptions-macos</guid><title>Uncaught exceptions on macOS</title><description>I recently came across a peculiar distinction between how exceptions manifest on macOS vs. iOS. On iOS, if an NSRangeException (index out of bounds) occurs, your app will crash, no questions asked. However, that is not always the case on macOS</description><link>https://siddarthkalra.github.io/posts/2019-04-19-uncaught-exceptions-macos</link><pubDate>Fri, 19 Apr 2019 18:45:00 -0400</pubDate><content:encoded><![CDATA[<p>I recently came across a peculiar distinction between how exceptions manifest on macOS vs. iOS.</p><p>On iOS, if an <code>NSRangeException</code> (index out of bounds) occurs, your app will crash, no questions asked. However, that is not always the case on macOS. This behaviour doesn't seem to be that widely known and I had to go digging quite a bit to uncover its roots.</p><p>On macOS, exceptions that go unhandled will rise to the level of the uncaught exception handler. This is the point where one can perform extra logic before the program exits. The default handler logs the exception to the console before exiting.</p><p>However, the key point is that exceptions on the main thread don't rise to the level of the uncaught exception handler as the global application object catches them preemptively. This is why certain exceptions don't lead to a crash on macOS. Apple details this behaviour <a href="https://developer.apple.com/library/archive/documentation/Cocoa/Conceptual/Exceptions/Concepts/UncaughtExceptions.html">here</a>.</p><p>If your app is using a crash reporting tool like <a href="https://Sentry.io">Sentry</a> or <a href="https://firebase.google.com/docs/crashlytics/">Crashlytics</a>, you don't want to silently log exceptions to the console. You want to know about them. So, how do we handle these exceptions?</p><p>We can subclass <code>NSApplication</code> and override the <code>reportException(_:)</code> method to provide our own custom behaviour:</p><pre><code><span class="splash-keyword">@objc</span>(<span class="splash-type">CustomExceptionHandlingApp</span>)
<span class="splash-keyword">class</span> CustomExceptionHandlingApp: <span class="splash-type">NSApplication</span> {

    <span class="splash-keyword">override func</span> reportException(<span class="splash-keyword">_</span> exception: <span class="splash-type">NSException</span>) {
        <span class="splash-type">UserDefaults</span>.<span class="splash-property">standard</span>.<span class="splash-call">register</span>(defaults: [<span class="splash-string">"NSApplicationCrashOnExceptions"</span>: <span class="splash-keyword">true</span>])

        <span class="splash-comment">// custom code to handle the exception here</span>

        <span class="splash-keyword">super</span>.<span class="splash-call">reportException</span>(exception)
    }

}
</code></pre><p>After creating the subclass, make sure to update the <code>NSPrincipalClass</code> key in your app's Info.plist to the name of the subclass instead of <code>NSApplication</code>.</p><p>The last thing to note is that if you want your application to exit when an exception occurs then set the <code>NSApplicationCrashOnExceptions</code> key to <code>true</code>.</p>]]></content:encoded></item><item><guid isPermaLink="true">https://siddarthkalra.github.io/posts/2019-04-06-side-effects</guid><title>Side effects</title><description>Side effects can have deadly consequences. We all pay attention to them when picking up a pack of antibiotics from the pharmacist. But are you paying attention to them when writing your next app feature?</description><link>https://siddarthkalra.github.io/posts/2019-04-06-side-effects</link><pubDate>Sat, 6 Apr 2019 18:45:00 -0400</pubDate><content:encoded><![CDATA[<p>Side effects can have deadly consequences. We all pay attention to them when picking up a pack of antibiotics from the pharmacist. But are you paying attention to them when writing your next app feature? If you haven't been, I'm here to convince you that it's worth reading the fine-print and avoiding them whenever possible.</p><img src="https://siddarthkalra.github.io/images/side-effects.jpg" alt="Side Effects meme"/><p>So, let's start by defining our terms. Side effects, in the realm of programming, are hidden consequences or changes. That is, when calling a function leads to something being accessed or changed outside the scope of that function. The function can then no longer be considered <a href="https://en.wikipedia.org/wiki/Pure_function">pure</a>. Here is an example of a pure function:</p><pre><code><span class="splash-keyword">func</span> multiplyBy2(<span class="splash-keyword">_</span> value: <span class="splash-type">Int</span>) -&gt; <span class="splash-type">Int</span> {
    <span class="splash-keyword">return</span> value * <span class="splash-number">2</span>
}
</code></pre><p>We usually want to aim for pure functions whenever possible because they allow us to locally reason about our program as there is no global impact upon invocation. Introducing side effects means that we may no longer be able to reason locally as changes at the global scope can be introduced. This increases the complexity of our program.</p><p>Today we're going to discuss two types of side effects: <strong>hidden inputs</strong> and <strong>hidden outputs</strong>. As a general rule, hidden changes are something that you want to avoid. Having implicit changes can make your API unclear and unobvious, which can lead to misuse and unintended results. Now that we've covered what side effects are, let's examine each flavor in detail.</p><p>Say, I'm writing a chat messaging app to break the dominance of WhatsApp in the market. That's going to be tough, so let's ensure that our basics are right first. To do this, I need a way to represent messages in my program. We'll start by defining a data structure that describes the main building block of the app:</p><pre><code><span class="splash-keyword">struct</span> ChatMessage {
    <span class="splash-keyword">let</span> userName: <span class="splash-type">String</span>
    <span class="splash-keyword">let</span> message: <span class="splash-type">String</span>
    <span class="splash-keyword">let</span> creationDate: <span class="splash-type">Date</span>
}
</code></pre><p>Now, I might want to display the chat messages a given user has sent over the last day. For that, I could write a function like so:</p><pre><code><span class="splash-keyword">func</span> getLastDaysChatMessages() -&gt; [<span class="splash-type">ChatMessage</span>]? {
  <span class="splash-keyword">guard let</span> rawChatMessages =
      <span class="splash-type">UserDefaults</span>.<span class="splash-property">standard</span>.<span class="splash-call">array</span>(forKey: <span class="splash-string">"chatMessages"</span>) <span class="splash-keyword">as</span>? [<span class="splash-type">RawChatMessage</span>] <span class="splash-keyword">else</span> { <span class="splash-keyword">return nil</span> }

  <span class="splash-keyword">let</span> yesterday = <span class="splash-type">Calendar</span>.<span class="splash-property">current</span>.<span class="splash-call">date</span>(byAdding: .<span class="splash-dotAccess">day</span>,
                                        value: -<span class="splash-number">1</span>,
                                        to: <span class="splash-type">Date</span>())!

    <span class="splash-keyword">return</span> rawChatMessages
        .<span class="splash-call">compactMap</span>(transformDictToChatMessage)
        .<span class="splash-call">filter</span> { $0.<span class="splash-property">creationDate</span> &gt; yesterday }
}
</code></pre><p>Even though this function gets the job done, we have a few problems. We've come across our first type of side effect. <code>UserDefaults.standard</code>, <code>Calendar.current</code> and <code>Date()</code> are all <strong>hidden inputs</strong>. <code>UserDefaults.standard</code> and <code>Calendar.current</code> are both singletons that can be altered by other parts of our program at any time. Also, since we only get the date at the time of invocation, this function will not produce predictable results if invoked multiple times, which reduces testability.</p><p>Let's see if we can restore predicability and remove outside influence to restore our ability to locally reason about this piece of code:</p><pre><code><span class="splash-keyword">func</span> getChatMessages(rawChatMessages: [<span class="splash-type">RawChatMessage</span>], filter: (<span class="splash-type">ChatMessage</span>) -&gt; <span class="splash-type">Bool</span>) -&gt; [<span class="splash-type">ChatMessage</span>] {
    <span class="splash-keyword">return</span> rawChatMessages
        .<span class="splash-call">compactMap</span>(transformDictToChatMessage)
        .<span class="splash-call">filter</span>(filter)
}

<span class="splash-comment">// Usage</span>
<span class="splash-keyword">let</span> yesterday = <span class="splash-type">Calendar</span>.<span class="splash-property">current</span>.<span class="splash-call">date</span>(byAdding: .<span class="splash-dotAccess">day</span>, value: -<span class="splash-number">1</span>, to: <span class="splash-type">Date</span>())!

<span class="splash-call">getChatMessages</span>(rawChatMessages: rawChatMessages,
                filter: { $0.<span class="splash-property">creationDate</span> &gt; yesterday })
</code></pre><p>In our above solution, we've leveraged dependency injection to remove <code>UserDefaults.standard</code> and <code>Calendar.current</code> from the equation altogether. Our function no longer cares about these concepts, which makes tests much easier to write. We've also added the <code>filter</code> parameter. Now a date can be injected. This will allow us to get predictable results when the function is invoked multiple times as the date will not change during each invocation.</p><p>Now that we have a clean way to retrieve chat messages, what about saving new ones? Let's start by taking the following approach:</p><pre><code><span class="splash-keyword">func</span> saveChatMessages(<span class="splash-keyword">_</span> chatMessages: [<span class="splash-type">ChatMessage</span>]) {
    chatMessages.<span class="splash-call">forEach</span> {
        <span class="splash-type">AnalyticsManager</span>.<span class="splash-property">shared</span>.<span class="splash-call">recordChatMessage</span>($0)
    }

    <span class="splash-keyword">let</span> rawChatMessages = chatMessages.<span class="splash-call">map</span>(transformChatMessageToDict)
    <span class="splash-type">UserDefaults</span>.<span class="splash-property">standard</span>.<span class="splash-call">set</span>(rawChatMessages, forKey: <span class="splash-string">"chatMessages"</span>)
}
</code></pre><p>So, here we have an <code>AnalyticsManager</code> recording some information. Maybe we're interested in tracking which of our users are the most active or which topics users are discussing on a given day. We're also persisting our chat messages to user defaults.</p><p>There's a lot going on here. Both <code>AnalyticsManager</code> and <code>UserDefaults</code> are reaching out to the outside world and making some sort of change. They are both examples of <strong>hidden outputs</strong>. Testing this function is going to take a bit of work. We can do better by breaking things apart.</p><pre><code><span class="splash-keyword">typealias</span> ProcessMessage = (<span class="splash-type">ChatMessage</span>) -&gt; <span class="splash-type">Void</span>

<span class="splash-keyword">func</span> saveChatMessages(<span class="splash-keyword">_</span> chatMessages: [<span class="splash-type">ChatMessage</span>], processMessage: <span class="splash-type">ProcessMessage</span>?) -&gt; [<span class="splash-type">RawChatMessage</span>] {
    <span class="splash-keyword">if let</span> processMessage = processMessage {
        chatMessages.<span class="splash-call">forEach</span>(processMessage)
    }

    <span class="splash-keyword">return</span> chatMessages.<span class="splash-call">map</span>(transformChatMessageToDict)
}
</code></pre><p>In this incarnation of our function, <code>AnalyticsManager</code> and <code>UserDefaults</code> are nowhere to be found so our tests don't have to worry about them. But we can still use both these classes in our app code. <code>AnalyticsManager</code> can be injected via the <code>processMessage</code> closure that can be optionally provided as a function parameter and we can process the raw chat messages and save them to <code>UserDefaults</code> by using the array returned by the function.</p><p>Side effects are quite common in many codebases. Our goal should always be to define a clear API and ensure that testing is not cumbersome. This is easier to do if we limit the side effects in our code. Introducing stronger forms of decoupling and ensuring that our functions are following the principal of <a href="https://en.wikipedia.org/wiki/Single_responsibility_principle">single responsibility</a> can go a long way in limiting the amount of side effects we have to live with.</p><p>Have you come across other types of side effects in your code? If so, let me know on Twitter <a href="https://twitter.com/siddarthkalra">@siddarthkalra</a>. All other forms of feedback are welcome as well. Have a great day and props to you for reading till the end!</p>]]></content:encoded></item><item><guid isPermaLink="true">https://siddarthkalra.github.io/posts/2019-03-15-collection-of-keypaths</guid><title>A collection of key paths, same root type but different values</title><description>I love Swift KeyPaths as they allow us to work in a type-safe environment. But I ran into a problem the other day when using them for a feature I was implementing.</description><link>https://siddarthkalra.github.io/posts/2019-03-15-collection-of-keypaths</link><pubDate>Fri, 15 Mar 2019 10:18:00 -0400</pubDate><content:encoded><![CDATA[<p>I love Swift <a href="https://developer.apple.com/documentation/swift/keypath"><code>KeyPaths</code></a> as they allow us to work in a type-safe environment. But I ran into a problem the other day when using them for a feature I was implementing.</p><p>I wanted the ability to create an array of <code>KeyPaths</code> where the <code>Root</code> was the same type but the <code>Value</code> types were different. The first thing I tried was this:</p><pre><code><span class="splash-keyword">class</span> Dog {
    <span class="splash-keyword">@objc let</span> name: <span class="splash-type">String</span> = <span class="splash-string">""</span>
    <span class="splash-keyword">@objc let</span> age: <span class="splash-type">Int</span> = <span class="splash-number">0</span>
}

<span class="splash-keyword">let</span> keyPaths = [\<span class="splash-type">Dog</span>.<span class="splash-property">name</span>, \<span class="splash-type">Dog</span>.<span class="splash-property">age</span>]
</code></pre><p>Xcode reports that <code>keyPaths</code> has the type <code>PartialKeyPath&lt;Dog&gt;</code>. This actually makes sense because <code>name</code> is a <code>String</code> while <code>age</code> is an <code>Int</code>. So, Swift uses a <a href="https://developer.apple.com/documentation/swift/partialkeypath"><code>PartialKeyPath</code></a>, which type-erases the <code>Values</code> for you.</p><p>This was great but didn't work for my particular problem. I wanted to use <code>KeyPaths</code> to represent property names in a type-safe manner. Given a <code>KeyPath</code>, print out the property name of the value, like so:</p><pre><code><span class="splash-keyword">func</span> printPropertyName&lt;Root, Value&gt;(keyPath: <span class="splash-type">KeyPath</span>&lt;<span class="splash-type">Root</span>, <span class="splash-type">Value</span>&gt;) {
    <span class="splash-keyword">let</span> propertyName = <span class="splash-type">NSExpression</span>(forKeyPath: keyPath).<span class="splash-property">keyPath</span>
    <span class="splash-call">print</span>(propertyName)
}

<span class="splash-call">printPropertyName</span>(keyPath: \<span class="splash-type">Dog</span>.<span class="splash-property">name</span>) <span class="splash-comment">// prints name</span>
<span class="splash-call">printPropertyName</span>(keyPath: \<span class="splash-type">Dog</span>.<span class="splash-property">age</span>) <span class="splash-comment">// prints age</span>
</code></pre><p><code>NSExpression</code> is a great Apple API that gives us the ability to retrieve the property name of a <code>KeyPath</code>, if the property is annotated with <code>@objc</code>.</p><p>Next, I wanted the ability to pass in a collection of <code>KeyPaths</code> like so:</p><pre><code><span class="splash-call">printPropertyNames</span>(keyPaths: [\<span class="splash-type">Dog</span>.<span class="splash-property">name</span>, \<span class="splash-type">Dog</span>.<span class="splash-property">age</span>])
</code></pre><p>As we saw earlier, the type of the array would be <code>PartialKeyPath&lt;Dog&gt;</code>. Unfortunately, since the <code>KeyPath's</code> <code>Value</code> is type-erased, we loose the ability to retrieve the property names and <code>NSExpression()</code> no longer works for us.</p><pre><code><span class="splash-keyword">func</span> printPropertyNames&lt;Root&gt;(keyPaths: [<span class="splash-type">PartialKeyPath</span>&lt;<span class="splash-type">Root</span>&gt;]) {
    keyPaths.<span class="splash-call">forEach</span> { keyPath <span class="splash-keyword">in
        let</span> valueName = <span class="splash-type">NSExpression</span>(forKeyPath: keyPath).<span class="splash-property">keyPath</span>
        <span class="splash-call">print</span>(valueName)
    }
}

<span class="splash-call">printPropertyNames</span>(keyPaths: [\<span class="splash-type">Dog</span>.<span class="splash-property">name</span>, \<span class="splash-type">Dog</span>.<span class="splash-property">age</span>])
</code></pre><p>The compiler tells us we're crazy by throwing an error <code>Cannot invoke initializer for type 'NSExpression' with an argument list of type '(forKeyPath: (PartialKeyPath&lt;Root&gt;))'</code> for the code shown above.</p><p>So, how do we get around this problem? Well, one approach is to wrap our <code>KeyPath</code> access in a closure.</p><p>Let's start by defining a function that makes this wrapping closure for us. We'll refer to the closure as a <code>PropertyRef</code>:</p><pre><code><span class="splash-keyword">typealias</span> PropertyName = <span class="splash-type">String</span>

<span class="splash-keyword">func</span> makePropertyRef&lt;Root, Value&gt;(keyPath: <span class="splash-type">KeyPath</span>&lt;<span class="splash-type">Root</span>, <span class="splash-type">Value</span>&gt;) -&gt; (<span class="splash-type">Root</span>.<span class="splash-type">Type</span>) -&gt; <span class="splash-type">PropertyName</span> {
    <span class="splash-keyword">return</span> { rootType <span class="splash-keyword">in
        let</span> propertyName = <span class="splash-type">NSExpression</span>(forKeyPath: keyPath).<span class="splash-property">keyPath</span>
        <span class="splash-keyword">return</span> propertyName
    }
}
</code></pre><p>Now, given a <code>KeyPath</code>, we can make a <code>PropertyRef</code>. All that remains is to rewrite our print property name function to work with <code>PropertyRefs</code> instead of <code>KeyPaths</code>:</p><pre><code><span class="splash-keyword">func</span> printPropertyNames&lt;Root&gt;(propertyRefs: (<span class="splash-type">Root</span>.<span class="splash-type">Type</span>) -&gt; <span class="splash-type">PropertyName</span>...) {
    <span class="splash-keyword">let</span> propertyNames = propertyRefs.<span class="splash-call">map</span> { $0(<span class="splash-type">Root</span>.<span class="splash-keyword">self</span>) }
    <span class="splash-call">print</span>(propertyNames)
}

<span class="splash-call">printPropertyNames</span>(propertyRefs: <span class="splash-call">makePropertyRef</span>(keyPath: \<span class="splash-type">Dog</span>.<span class="splash-property">name</span>), <span class="splash-call">makePropertyRef</span>(keyPath: \<span class="splash-type">Dog</span>.<span class="splash-property">age</span>))
</code></pre><p>This is great because we retain the type-safety that KeyPaths give us and it stops us from mixing <code>Root</code> types, which is exactly what we want.</p><pre><code><span class="splash-call">printPropertyNames</span>(propertyRefs: <span class="splash-call">makePropertyRef</span>(keyPath: \<span class="splash-type">Dog</span>.<span class="splash-property">breed</span>)) <span class="splash-comment">// compiler error</span>
<span class="splash-call">printPropertyNames</span>(propertyRefs: <span class="splash-call">makePropertyRef</span>(keyPath: \<span class="splash-type">Dog</span>.<span class="splash-property">name</span>), <span class="splash-call">makePropertyRef</span>(keyPath: \<span class="splash-type">Cat</span>.<span class="splash-property">age</span>)) <span class="splash-comment">// compiler error</span>
</code></pre><p>So, there you have it. We now have the ability to produce a collection of <code>KeyPaths</code> where our <code>Root</code> is the same but the values are different while retaining our ability to access the property names of the <code>Values</code>.</p>]]></content:encoded></item></channel></rss>